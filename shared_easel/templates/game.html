{% load static %}
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Escape</title>
    
    <link rel="stylesheet" type="text/css" href="{% static 'escape/vendor/bootstrap/css/bootstrap.min.css' %}">
    <script type="text/javascript" src="{% static 'escape/vendor/jquery/jquery-3.3.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'escape/vendor/paper/paper-full.min.js' %}"></script>
    
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        let currentCorrectAnswer = "H";
        let currentCorrectColor = "red";
        // $( function() {
        //   $( ".dragDomino" ).draggable();
        // } );
        $(function () {
			$(".dragDomino").draggable({
				revert : function(event, ui) {
					// on older version of jQuery use "draggable"
					// $(this).data("draggable")
					// on 2.x versions of jQuery use "ui-draggable"
					// $(this).data("ui-draggable")
					$(this).data("ui-draggable").originalPosition = {
						top : 0,
						left : 0
					};
					// return boolean
					return !event;
					// that evaluate like this:
					// return event !== false ? false : true;
				}
			});
			$("#targetArea").droppable({
				// activeClass: "active",
				// hoverClass: "hover",
				// // drop: function (event, ui) {
					// // 	$("#dragbox").
					// // }
					classes: {
						//"ui-droppable-active": "ui-state-active",
						"ui-droppable-hover": "ui-state-hover"
					},
					accept: ".dragDomino",
					activeClass: "ui-state-highlight",
					over: function( event, ui ) {
						// over droppable        
						console.log('over');
                        let id = $(ui.draggable).attr('id')
                        let queryString = "#" + id + " > p:nth-child(2)"  
                        
                        if (checkAnswer(queryString)){
                            ui.helper
						        .addClass("ui-over")
						        .addClass($(this).attr('id'))
                                .addClass('correct')
                        } else {
                            ui.helper
						        .addClass("ui-over")
						        .addClass($(this).attr('id'));
                        }
					},
					out: function( event, ui ) {
						// not over droppable
						//console.log('out');
						
						// reset
						ui.helper
						.removeClass("ui-over")
						.removeClass("dropped");
						
					},
					drop: function( event, ui ) {
						// dropped
                        // If this is the wrong answer, return the domino to it's original location
                        
                        
                        let id = $(ui.draggable).attr('id')
                        console.log(id)
                        let queryString = "#" + id + " > p:nth-child(2)" 

                        //let element = document.querySelector(`$(ui.draggable).attr('id') > div`)
                        //console.log(element)
                        let l = document.querySelector(queryString).textContent;
                        //let c = document.querySelector(queryString).background;
                        //let correct = checkAnswer(document.querySelector(queryString).textContent)
                        if (checkAnswer(queryString)){
                            updateBigScreen();
                            updateSmallScreen();
                            updateCorrectAnswer();
                        }
                        
                        // console.log($(this).attr('id'));
						//console.log('drop');
						ui.helper
						.addClass("dropped")
						.addClass($(this).attr('id'));
						//$(this).addClass('dropped');
					},
				});
			});
        function getCorrectAnswer(){
            return currentCorrectAnswer;
        }
        function updateCorrectAnswer() {
            // ok yes so I hard coded these values, I should not have done that but oh well
            switch (letter) {
                case "H":
                    currentCorrectAnswer = "E";
                    break;
                case "E":
                    currentCorrectAnswer = "A";
                    break;
                case "A":
                    currentCorrectAnswer = "R";
                    break;
                case "R":
                    currentCorrectAnswer = "T";
                    break;
                case "T":
                    // they have won the game! 
                    break;
                default:
                    break;
            }
        }
        
        function getCorrectColor(){
            return currentCorrectColor;
        }
        // returns true if the answer is correct, false otherwise
        function checkAnswer(queryString){
            
            let l = document.querySelector(queryString).textContent;
            
            let ca = getCorrectAnswer();
            
            let cc = getCorrectColor();
        
            //console.log("l = " + l+ ", c = "+ c);
            console.log(", ca = "+ ca + ", cc = "+ cc)
            if (l == getCorrectAnswer() && cc == getCorrectColor()){
                console.log("check answer is true")
            }
            else{
                console.log("current correct answer is " + currentCorrectAnswer) 
                console.log("check answer is false")
            }
            // if the document element 
        }
        </script>
   
    <style>
        /*Universal selector*/
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        
        /*Class selector*/
        .domino {
            display: inline-block;
            height: 100px;
            width: 40px;
            background-color: rgb(240, 240, 240);
            border: 1px solid black;
            border-radius: 5px;
            position: relative;
        }
        
        /*CSS speudo element, to style a specific part of the element*/
        .domino::after {
            /* Ligne de séparation centrale */
            content: "";
            background-color: black;
            height: 1px;
            width: 32px;
            position: absolute;
            top: 50px;
            left: 4px;
        }
        
        /*Class + element*/
        .domino p {
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .reds{
            background-color: red;
        }

        .blues{
            background-color: blue;
        }

        .yellows{
            background-color: yellow;
        }
        .greens {
            background-color: rgb(117, 133, 117) ;
        }
        
        .ui-over.dragDomino {
			background: grey !important;
		}
        .ui-over.dragDomino.correct {
			background-color: green !important;
		}
        

    </style>
</head>
<body>
    <div class="container-fluid">
        <div id="countdown-container">
            <p class="countdown-text">Game Time Remaining:</p>
            <p>&emsp;</p>
            <p id="countdown">0:01</p>
        </div>
        <div id="bigScreen" class="row">
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-6">
                        <h2>
                            Solve the following riddle
                        </h2>
                    </br>
                        <p>“If you break me, I’ll not stop working.</p>
                        <p>If you can touch me, my work is done. </p>  
                        <p>If you lose me, you must find me with a ring soon after. What am I?”</p>
                        <p>– “Wizard and Glass” by Stephen King</p>
                        </br>
                        </br>
                        <div class="row" id="answerEntryArea">
                            <div class="col-md-1" id="box0">H
                            </div>
                            <div class="col-md-1" id="box1">E
                            </div>
                            <div class="col-md-1" id="box2">A
                            </div>
                            <div class="col-md-1" id="box3">R
                            </div>
                            <div class="col-md-1" id="box4">T
                            </div>
                            <div class="col-md-7">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <img alt="Padlock" src="{% static 'img/lock.jpg' %}" style="height: 50%;"/>
                    </div>
                    
                </div>
            </div>
        </div>
        <div id="dominosContainer">
            <div class="row">
                
                <div class="col-12" id="targetArea">
                    <svg width="100%" height="110">
                        <g>
                            <rect width="100%" height="100" style="fill:rgb(255, 255, 255);stroke-width:3;stroke:rgb(0,0,0)" />
                            <text x="50%" y="50%" font-family="Verdana" font-size="35" fill="blue">Target Area</text>
                        </g>
                      </svg>
                </div>
            </div>
            <!-- #domino2 > div > p:nth-child(2)
            document.querySelector("#domino2 > div > p:nth-child(2)") -->
            <div class="row correct">
                <div class="col-3 " >
                    <div class="domino reds ui-widget-content dragDomino" id="domino0">
                        <p class="top">1</p>
                        <p>H</p>
                      </div>
                </div>
                <div class="col-3 ">
                    <div class="domino blues dragDomino ui-widget-content" id="domino1">
                        <p class="top">2</p>
                        <p>P</p>
                      </div>
                </div>
                <div class="col-3 " >
                    <div class="domino yellows dragDomino ui-widget-content" id="domino2">
                        <p class="top">3</p>
                        <p>A</p>
                      </div>
                </div>
                <div class="col-3">
                    <div class="domino dragDomino ui-widget-content"  id="domino3">
                        <p class="top">5</p>
                        <p>I</p>
                      </div>
                </div>
            </div>
            <div class="row">
                <div class="col-3 ">
                    <div class="domino reds dragDomino ui-widget-content"  id="domino4">
                        <p class="top">3</p>
                        <p>E</p>
                      </div>
                </div>
                <div class="col-3 " id="domino5">
                    <div class="domino dragDomino ui-widget-content">
                        <p class="top">6</p>
                        <p>E</p>
                      </div>
                </div>
                <div class="col-3 " id="domino6">
                    <div class="domino dragDomino ui-widget-content">
                        <p class="top">2</p>
                        <p>L</p>
                      </div>
                </div>
                <div class="col-3" id="domino7">
                    <div class="domino dragDomino ui-widget-content">
                        <p class="top">9</p>
                        <p class="bottom">A</p>
                      </div>
                </div>
                
            </div>
            <div class="row">
                <div class="col-3" id="domino8">
                    <div class="domino reds dragDomino ui-widget-content">
                        <p class="top">2</p>
                        <p>R</p>
                      </div>
                </div>
                <div class="col-3 dragDomino ui-widget-content" id="domino9">
                    <div class="domino">
                        <p class="top">6</p>
                        <p>T</p>
                      </div>
                </div>
                <div class="col-3" id="domino10">
                    <div class="domino dragDomino ui-widget-content">
                        <p class="top">3</p>
                        <p>G</p>
                      </div>
                </div>
                <div class="col-3" id="domino11">
                    <div class="domino dragDomino ui-widget-content">
                        <p class="top">8</p>
                        <p class="bottom">F</p>
                      </div>
                </div>
            </div>
        
    </div>
</body>

<script>
    function countdown( elementName, minutes, seconds ) {
		var element, endTime, hours, mins, msLeft, time;
		function twoDigits( n ){
			return (n <= 9 ? "0" + n : n);
		}
		function updateTimer(){
			msLeft = endTime - (+new Date);
			if ( msLeft < 1000 ) {
				element.innerHTML = "Time is up!";
			} else {
				time = new Date( msLeft );
				hours = time.getUTCHours();
				mins = time.getUTCMinutes();
				element.innerHTML = (hours ? hours + ':' + twoDigits( mins ) : mins) + ':' + twoDigits( time.getUTCSeconds() );
				setTimeout( updateTimer, time.getUTCMilliseconds() + 500 );
			}
		}
		
		element = document.getElementById( elementName );
		endTime = (+new Date) + 1000 * (60*minutes + seconds) + 500;
		updateTimer();
	}
    countdown("countdown", 600000/60000, 0);
    
</script>
</html>


 <!-- <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-md-6">
                        <h2>
                            Your Riddle is:
                        </h2>
                        <p>“If you break me, I’ll not stop working.</p>
                        <p>If you can touch me, my work is done. </p>  
                        <p>If you lose me, you must find me with a ring soon after. What am I?”</p>
                        <p>– “Wizard and Glass” by Stephen King</p>
                    </div>
                    <div class="col-md-6">
                        <img alt="Bootstrap Image Preview" src="{% static 'img/lock.jpg' %}" />
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-1">H
                    </div>
                    <div class="col-md-1">E
                    </div>
                    <div class="col-md-1">A
                    </div>
                    <div class="col-md-1">R
                    </div>
                    <div class="col-md-1">T
                    </div>
                    <div class="col-md-7">
                    </div>
                </div>
            </div>
        </div>
    </div> -->
    <!-- <div class="container">
        <div class="row">
            <div class="col">
                <h1></h1>
                <p>“If you break me, I’ll not stop working.</p>
                <p>If you can touch me, my work is done. </p>  
                <p>If you lose me, you must find me with a ring soon after. What am I?”</p>
                <p>– “Wizard and Glass” by Stephen King</p>   
            </div>
        </div>
        <div class="row">
            <div class="col">
                <img src="{% static 'img/lock.jpg' %}">
            </div>
        </div>
        <div class="row">
            <div class="card" id="card1">
                <div class="card-body">
                    <h5 class="card-title">Special title treatment</h5>
                    
                </div>
            </div>
            <div class="card" id="card2">
                <div class="card-body">
                    <h5 class="card-title">Special title treatment</h5>
                    
                </div>
            </div>
            <div class="card" id="card3">
                <div class="card-body">
                    <h5 class="card-title">Special title treatment</h5>
                    
                </div>
            </div>
            <div class="card" id="card4">
                <div class="card-body">
                    <h5 class="card-title">Special title treatment</h5>
                    
                </div>
            </div>
            <div class="card" id="card5">
                <div class="card-body">
                    <h5 class="card-title">Special title treatment</h5>
                    
                </div>
            </div>
        </div>
        
    </div> -->
    
    
    


